<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <title>E-Park Manage Booking</title>
  </head>
  <body>
    <!-- top navigation bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-navbar fixed-top">
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#sidebar"
          aria-controls="offcanvasExample"
        >
          <span class="navbar-toggler-icon" data-bs-target="#sidebar"></span>
        </button>
        <a
          class="navbar-brand me-auto ms-lg-0 ms-3 text-uppercase fw-bold"
          href="#"
          >E-Park-clerk</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#topNavBar"
          aria-controls="topNavBar"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="topNavBar">
          <form class="d-flex ms-auto my-3 my-lg-0">
            <div class="input-group">
              <!-- <input
                class="form-control"
                type="search"
                placeholder="Search"
                aria-label="Search"
              />
              <button class="btn btn-primary" type="submit">
                <i class="bi bi-search"></i>
              </button> -->
            </div>
          </form>
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle ms-2"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-fill"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="/clerk-profile">Profile</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/admin-logout">Logout</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- top navigation bar -->
    <!-- offcanvas -->
    <div
      class="offcanvas offcanvas-start sidebar-nav bg-light"
      tabindex="-1"
      id="sidebar"
    >
      <div class="offcanvas-body p-0">
        <nav class="navbar-light">
          <ul class="navbar-nav">
            <li></li>
            <li class="my-4"><hr class="dropdown-divider bg-light" /></li>
            <li>
              <div class="text-muted small fw-bold text-uppercase px-3">
                Management
              </div>
            </li>
            <li>
              <a href="/manage-parking-clerk" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-graph-up"></i></span>
                <span>Manage Parking</span>
              </a>
            </li>

            <li>
              <a href="/manage-booking-clerk" class="nav-link px-3">
                <span class="me-2"><i class="bi bi-table"></i></span>
                <span>Manage Booking</span>
              </a>
            </li>
            <li class="my-4"><hr class="dropdown-divider bg-light" /></li>
          </ul>
        </nav>
      </div>
    </div>

    <!--testing scan kunware -->
    <div class="modal" id="myModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Scan and update entry and exit</h5>
            <button
              type="button"
              class="btn-close-white"
              data-bs-dismiss="modal"
            >
              x
            </button>
          </div>

          <h1>Ready to Scan</h1>
        </div>
      </div>
    </div>

    <!-- offcanvas -->
    <main class="mt-5 pt-3">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <h4>Manage Booking</h4>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12 mb-3">
            <div class="card">
              <div class="card-header">
                Data Table
                <div style="float: left; width: 14%">
                  <h4>
                    Filter<span><i class="bi bi-table me-2"></i></span>
                  </h4>
                </div>

                <button
                  type="text"
                  class="btn btn-primary"
                  style="float: right; margin-left: 6px"
                >
                  Filter
                </button>
                <input type="date" id="date" style="float:right;width:105%;margin-right:6px;"class="form-control">

                <div style="float: right; width: 14%; margin-left: 6px">
                  <select type="text" id="status" class="form-control">
                    <option value="">All Status</option>
                    <option value="exited">Exited</option>
                    <option value="unpaid">Unpaid</option>
                    <option value="entered">Entered</option>
                    <option value="expired">Expired</option>
                    <option value="canceled">Canceled</option>
                    <option value="reserved">Reserved</option>
                    <option value="paid">Paid</option>
                  </select>
                </div>
                <!-- <div style="float: right; width: 14%; margin-left: 6px">
                  <select type="text" id="vehicle" class="form-control">
                    <option value="">All Vehicle</option>
                    <option value="Motorcycle">Motorcycle</option>
                    <option value="Pickup truck">Pickup truck</option>
                    <option value="Sedan">Sedan</option>
                    <option value="SUV">SUV</option>
                    <option value="Van">Van</option>
                  </select>
                </div> -->
                <div style="float: right; width: 14%; margin-left: 6px">
                  <input
                    type="text"
                    id="plate"
                    placeholder="Plate number"
                    class="form-control"
                  />
                </div>
                <div style="float: right; width: 14%; margin-left: 6px">
                  <input
                    type="text"
                    id="name"
                    placeholder="Name"
                    class="form-control"
                  />
                </div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table
                    id="example"
                    class="table table-striped data-table"
                    style="width: 100%"
                  >
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Slot</th>
                        <th>Name</th>
                        <th>Plate</th>
                        <th>Price</th>
                        <th>Mobile</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>Status</th>
                        <th>Action</th>
                        <th>QR Code</th>
                      </tr>
                    </thead>
                    <tbody id="datatable2">
                      <% for(var i = 0; i < allbooking.length; i++) {%>
                      <!-- <input value="" hidden> -->
                      <tr>
                        <td><%= i + 1 %></td>
                        <td><%= allbooking[i].slot_id%></td>
                        <td><%= allbooking[i].user_name %></td>
                        <td><%= allbooking[i].plate %></td>
                        <td><%= allbooking[i].total_price %></td>
                        <td><%= allbooking[i].user_mobile %></td>
                        <td>
                          <!-- entry table -->
                          <% if(allbooking[i].book_status == 'paid' &&
                          allbooking[i].date_entry == null){ %>
                          <p style="color: blue">No entry yet</p>
                          <% }else if(allbooking[i].book_status == 'unpaid'){ %>
                          <p style="color: red">Cannot enter yet</p>
                          <% }else if(allbooking[i].book_status == 'expired'){
                          %>
                          <p style="color: red">No Entry</p>
                          <% }else if(allbooking[i].book_status == 'cancel'){ %>
                          <p style="color: red">Cannot Enter</p>
                          <% }else {%> <%= allbooking[i].date_entry %> <% } %>
                        </td>
                        <td>
                          <!-- exit table -->
                          <% if(allbooking[i].date_exit == null){ %>

                          <p style="color: blue">No exit</p>

                          <% }else { %>
                          <!-- if rate type is hourly and user parking time is sobra mag rered to(naubos na english ko) -->
                          <% if(allbooking[i].date_exit >=
                          allbooking[i].park_hrs && allbooking[i].date_exit !=
                          0){ %>
                          <p style="color: red">
                            <%= allbooking[i].date_exit %>
                          </p>
                          <% }else{ %> <%= allbooking[i].date_exit %> <% }%> <%
                          }%>
                        </td>
                        <% if(allbooking[i].book_status == 'paid' &&
                        allbooking[i].date_entry == null) {%>
                        <td>
                          <a
                            href="#"
                            class="btn btn-warning"
                            style="width: 100px"
                            >Reserved</a
                          >
                        </td>
                        <% }%> <% if( allbooking[i].book_status == 'unpaid') {%>
                        <td>
                          <a href="#" class="btn btn-dark" style="width: 100px"
                            >Unpaid</a
                          >
                        </td>
                        <% }%> <% if( allbooking[i].book_status == 'expired')
                        {%>
                        <td>
                          <a
                            href="#"
                            class="btn btn-secondary"
                            style="width: 100px"
                            >Expired</a
                          >
                        </td>
                        <% }%> <% if( allbooking[i].book_status == 'cancel') {%>
                        <td>
                          <a href="#" class="btn btn-danger">Canceled</a>
                        </td>
                        <% }%> <% if( allbooking[i].book_status == 'exited') {%>
                        <td>
                          <a
                            href="#"
                            class="btn btn-success"
                            style="width: 100px"
                            >Done</a
                          >
                        </td>
                        <% }%> <% if( allbooking[i].book_status == 'paid' &&
                        allbooking[i].date_entry != null ) {%>
                        <td>
                          <a href="#" class="btn btn-primary">Occupied</a>
                        </td>
                        <% }%>
                        <!-- action table -->
                        <td>
                          <% if( allbooking[i].book_status == 'unpaid' ) {%>
                          <div class="d-flex gap-1">
                            <form
                              class="user-form"
                              id="login-form"
                              action="/api/update-paid"
                              method="post"
                            >
                              <input
                                type="number"
                                value="<%= allbooking[i].booking_id  %>"
                                name="booking_id"
                                id="booking_id"
                                hidden
                              />
                              <button
                                type="submit"
                                class="btn btn-primary"
                                href="javascript:{}"
                                onclick="document.getElementById('login-form').submit();"
                              >
                                Paid
                              </button>
                            </form>
                            <form
                              class="user-form"
                              id="cancel-booking"
                              action="/api/clerk-cancel-booking"
                              method="post"
                            >
                              <input
                                type="number"
                                value="<%= allbooking[i].booking_id  %>"
                                name="booking_id"
                                id="booking_id"
                                hidden
                              />
                              <button
                                type="submit"
                                class="btn btn-danger"
                                href="javascript:{}"
                                onclick="document.getElementById('cancel-booking').submit();"
                              >
                                Cancel
                              </button>
                            </form>
                          </div>

                          <% }%>
                        </td>

                        <td>
                          <% if( allbooking[i].book_status == 'paid') { %>
                          <button
                            data-toggle="modal"
                            data-id="<%=allbooking[i].booking_id %>"
                            class="open-AddBookDialog btn btn-primary"
                            href="#addBookDialog"
                          >
                            View
                          </button>
                          <% }else if( allbooking[i].date_exit == null &&
                          allbooking[i].date_entry != null ){ %>
                          <button
                            data-toggle="modal"
                            data-id="<%=allbooking[i].booking_id %>"
                            class="open-AddBookDialog btn btn-primary"
                            href="#addBookDialog"
                          >
                            View
                          </button>
                          <% }else{ %> Not Available <% } %>
                        </td>
                      </tr>

                      <% } %>
                    </tbody>
                    <tfoot></tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="addBookDialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">QR Code</h5>
            </div>

            <div class="modal-body">
              <input
                type="text"
                name="booking_id"
                id="booking_id"
                value=""
                hidden
              />

              <div id="qrcode">
                <center>
                  <img
                    src="images/thumbnail.png"
                    style="width: 80%; height: 80%"
                  />
                </center>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
    <script src="/js/jquery-3.5.2.js"></script>
    <script src="/js/jquery.dataTables.min.js"></script>
    <script src="/js/dataTables.bootstrap5.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/qr-clerk.js"></script>
    <script src="/js/filter-clerk.js"></script>

    <script>
      $("#open-modal").click(function () {
        console.log("Hello");
        var socket = io();

        socket.emit("data", (data) => {
          console.log("hello world berwyn!");
        });

        socket.on("redirect", (data) => {
          window.location.href = "/manage-booking-clerk";
        });
      });
    </script>
  </body>
</html>
